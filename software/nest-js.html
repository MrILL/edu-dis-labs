<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Розроблення веб-сервера за допомогою NestJS | Розробка RESTFull сервісу на NestJS</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/edu-dis-labs/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="description" content="Лабораторні роботи з дисципліни "Розподілені інформаційні системи"">
    
    <link rel="preload" href="/edu-dis-labs/assets/css/0.styles.bc1065be.css" as="style"><link rel="preload" href="/edu-dis-labs/assets/js/app.7ef3414e.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/2.3e2da508.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/22.75c2533e.js" as="script"><link rel="prefetch" href="/edu-dis-labs/assets/js/10.6618298c.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/11.7227b195.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/12.81e55c03.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/13.2abc48b3.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/14.8aaa01e4.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/15.52f7ea50.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/16.829f7456.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/17.b64e46de.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/18.85c55c8e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/19.8430de89.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/20.55d9ac91.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/21.8350c8fe.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/23.82cf0d10.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/24.7e3296a8.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/25.4d9e7944.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/26.87ff770b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/3.90e6307c.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/4.6821b8c5.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/5.8b0efd2b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/6.df292a59.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/7.ad42eb08.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/8.21e8fb7d.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/9.cce8dc66.js">
    <link rel="stylesheet" href="/edu-dis-labs/assets/css/0.styles.bc1065be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/edu-dis-labs/" class="home-link router-link-active"><!----> <span class="site-name">Розробка RESTFull сервісу на NestJS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/mrill/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/mrill/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/edu-dis-labs/intro/" class="sidebar-link">Вступ</a></li><li><a href="/edu-dis-labs/requirements/" class="sidebar-link">Розроблення вимог до системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#основні-визначення" class="sidebar-link">Основні визначення</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#підходи-та-способи-вирішення-завдання" class="sidebar-link">Підходи та способи вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#порівняльна-характеристика-існуючих-засобів-вирішення-завдання" class="sidebar-link">Порівняльна характеристика існуючих засобів вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#висновки" class="sidebar-link">Висновки</a></li></ul></li><li><a href="/edu-dis-labs/design/" class="sidebar-link">Проєктування архітектури системи</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/edu-dis-labs/software/" class="sidebar-heading clickable router-link-active open"><span>Реалізація інформаційного та програмного забезпечення</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/edu-dis-labs/software/nest-js.html" aria-current="page" class="active sidebar-link">Розроблення веб-сервера за допомогою NestJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#філософія" class="sidebar-link">Філософія</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#підготовлення-проекту" class="sidebar-link">Підготовлення проекту</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#встановлення-залежностеи" class="sidebar-link">Встановлення залежностей</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#першии-запуск-та-конфігурування-серверу" class="sidebar-link">Перший запуск та конфігурування серверу</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#налаштування-проміжного-пз-доступ-до-статичних-фаилів" class="sidebar-link">Налаштування проміжного ПЗ. Доступ до статичних файлів</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#оброблення-запитів" class="sidebar-link">Оброблення запитів</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/nest-js.html#оброблення-параметрів-запиту" class="sidebar-link">Оброблення параметрів запиту</a></li></ul></li><li><a href="/edu-dis-labs/software/restfull-services.html" class="sidebar-link">RESTfull сервіси</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#підготовлення-проекту" class="sidebar-link">Підготовлення проекту</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#написання-dto" class="sidebar-link">Написання DTO</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#розроблення-контролера" class="sidebar-link">Розроблення контролера</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#розроблення-сервісу" class="sidebar-link">Розроблення сервісу</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#розроблення-репозиторію" class="sidebar-link">Розроблення репозиторію</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#перевірка-працездатності-сервісу" class="sidebar-link">Перевірка працездатності сервісу</a></li></ul></li></ul></section></li><li><a href="/edu-dis-labs/test/" class="sidebar-link">Тестування працездатності системи</a></li><li><a href="/edu-dis-labs/conclusion/" class="sidebar-link">Висновки</a></li><li><a href="/edu-dis-labs/api/" class="sidebar-link">API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="розроблення-веб-сервера-за-допомогою-nestjs"><a href="#розроблення-веб-сервера-за-допомогою-nestjs" class="header-anchor">#</a> Розроблення веб-сервера за допомогою NestJS</h1> <h2 id="філософія"><a href="#філософія" class="header-anchor">#</a> Філософія</h2> <p><strong>FIX</strong> In recent years, thanks to Node.js, JavaScript has become the “lingua franca” of the web for both front and backend applications. This has given rise to awesome projects like Angular, React and Vue, which improve developer productivity and enable the creation of fast, testable, and extensible frontend applications. However, while plenty of superb libraries, helpers, and tools exist for Node (and server-side JavaScript), none of them effectively solve the main problem of - Architecture.</p> <p><strong>FIX</strong> Nest provides an out-of-the-box application architecture which allows developers and teams to create highly testable, scalable, loosely coupled, and easily maintainable applications. The architecture is heavily inspired by Angular и использует IOC для выстраивания зависимостей между модулями. Также в проекте будет частично использоваться Onion-архитектура</p> <h2 id="підготовлення-проекту"><a href="#підготовлення-проекту" class="header-anchor">#</a> Підготовлення проекту</h2> <p>Для початку роботи необхідно встановити <a href="https://nodejs.org/uk/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Перевірити це встановлення за допомогою команд:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>node --version    
v16.13.2
     
<span class="token function">npm</span> --version              
<span class="token number">8.1</span>.2  
</code></pre></div><p><strong>FIX</strong> To get started, you can either scaffold the project with the <a href="https://docs.nestjs.com/cli/overview" target="_blank" rel="noopener noreferrer">Nest CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To scaffold the project with the Nest CLI, run the following commands. This will create a new project directory, and populate the directory with the initial core Nest files and supporting modules, creating a conventional base structure for your project.</p> <p>При вибору пакетного менеджеру будемо використовувати <strong>npm</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -g @nestjs/cli
nest new project-name
</code></pre></div><p>Створилася папка <code>project-name</code> з наступною структурою:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├─ src/
<span class="token operator">|</span>  ├─ app.controller.spec.ts
<span class="token operator">|</span>  ├─ app.controller.ts
<span class="token operator">|</span>  ├─ app.module.ts
<span class="token operator">|</span>  ├─ app.service.ts
<span class="token operator">|</span>  └─ main.ts
├─ test/
<span class="token operator">|</span>  ├─ app.e2e-spec.ts
<span class="token operator">|</span>  └─ jest-e2e.ts
├─ .eslintrc.js
├─ .gitignore
├─ .prettierc
├─ nest-cli.json
├─ package.json
├─ tsconfig.build.json
└─ tsconfig.json
</code></pre></div> <p>Призначення каталогів та файлів:</p> <p><code>src/</code> — весь код<br> <code>src/app.controller.spec.ts</code> — юніт тести для контроллеру модуля app<br> <code>src/app.controller.ts</code> — код контроллера<br> <code>src/app.module.ts</code> — код модуля для IoC NestJS де імортуються зовнішні модулі, визначаються контроллери, сервіси та провайдери модуля та сервіси які модуль може експортувати<br> <code>src/main.ts</code> — вхідна точка коду<br></p> <p>Інші файли які знаходяться в руті виконують функцію налаштування певних засобів роботи з кодом.</p> <h2 id="встановлення-залежностеи"><a href="#встановлення-залежностеи" class="header-anchor">#</a> Встановлення залежностей</h2> <p>Бойлерплейт NestJS заздалегідь попіклувався про базові залежності які пов'язані з cli, кодогенерацією, ядром NestJS, тестуванням, тайпскриптом та іншим.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;project-name&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UNLICENSED&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prebuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nest build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prettier --write \&quot;src/**/*.ts\&quot; \&quot;test/**/*.ts\&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nest start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nest start --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nest start --debug --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node dist/main&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint \&quot;{src,apps,libs,test}/**/*.ts\&quot; --fix&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:cov&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --coverage&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:e2e&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --config ./test/jest-e2e.json&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@nestjs/common&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/platform-express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reflect-metadata&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.1.13&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rimraf&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rxjs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.2.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@nestjs/cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/schematics&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/testing&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.13&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;27.4.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^16.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/supertest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.11&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@typescript-eslint/parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint-config-prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint-plugin-prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^27.2.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.3.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;source-map-support&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.5.20&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;supertest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.1.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts-jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^27.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.2.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts-node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tsconfig-paths&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.10.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.5&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;moduleFileExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ts&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rootDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testRegex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.*\\.spec\\.ts$&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;^.+\\.(t|j)s$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-jest&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;collectCoverageFrom&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;**/*.(t|j)s&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;coverageDirectory&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../coverage&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testEnvironment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Щоб не йти вріз з Dependency Injection використовуючи на кшталт <code>process.env</code> для доступу до змінних середовища будемо використовувати модуль <code>@nestjs/config</code>, який при необхідності можна буде замінити своїм, який наприклад підтягує налаштування з окремого сервера.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i --save @nestjs/config @nestjs/serve-static cookie-parser

<span class="token function">npm</span> i -D @types/cookie-parser
</code></pre></div><p>Відповідно у файл <code>package.json</code> додасться відповідні строчки:</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code>  ...
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@nestjs/common&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/mapped-types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/platform-express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@nestjs/serve-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.2.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cookie-parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.4.6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reflect-metadata&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.1.13&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rimraf&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rxjs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.2.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
</code></pre></div><h2 id="першии-запуск-та-конфігурування-серверу"><a href="#першии-запуск-та-конфігурування-серверу" class="header-anchor">#</a> Перший запуск та конфігурування серверу</h2> <p>У бойлерплейті вже визначений певний функціонал:
<strong>FIX</strong> The main.ts includes an async function, which will bootstrap our application:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>FIX</strong> To create a Nest application instance, we use the core NestFactory class. NestFactory exposes a few static methods that allow creating an application instance. The create() method returns an application object, which fulfills the INestApplication interface. This object provides a set of methods which are described in the coming chapters. In the main.ts example above, we simply start up our HTTP listener, which lets the application await inbound HTTP requests.</p> <p><strong>FIX</strong> Note that a project scaffolded with the Nest CLI creates an initial project structure that encourages developers to follow the convention of keeping each module in its own dedicated directory</p> <p><strong>FIX</strong> Nest aims to be a platform-agnostic framework. Platform independence makes it possible to create reusable logical parts that developers can take advantage of across several different types of applications. Technically, Nest is able to work with any Node HTTP framework once an adapter is created. There are two HTTP platforms supported out-of-the-box: express and fastify. You can choose the one that best suits your needs.</p> <p><strong>FIX</strong> We're gonna use express as platform -- it have broad support of <strong>Express is a well-known minimalist web framework for node. It's a battle tested, production-ready library with lots of resources implemented by the community. The @nestjs/platform-express package is used by default. Many users are well served with Express, and need take no action to enable it.</strong></p> <p><strong>FIX</strong> Each application has at least one module, a root module — in our case it's <code>AppModule</code>. The root module is the starting point Nest uses to build the application graph - the internal data structure Nest uses to resolve module and provider relationships and dependencies. While very small applications may theoretically have just the root module, this is not the typical case. We want to emphasize that modules are strongly recommended as an effective way to organize your components. Thus, for most applications, the resulting architecture will employ multiple modules, each encapsulating a closely related set of capabilities.</p> <p><strong>FIX</strong> The @Module() decorator takes a single object whose properties describe the module:</p> <p><strong>FIX</strong>
providers	the providers that will be instantiated by the Nest injector and that may be shared at least across this module
controllers	the set of controllers defined in this module which have to be instantiated
imports	the list of imported modules that export the providers which are required in this module
exports	the subset of providers that are provided by this module and should be available in other modules which import this module. You can use either the provider  itself or just its token (provide value)</p> <p>Now we can import the ConfigModule. Typically, we'll import it into the root AppModule and control its behavior using the <code>.forRoot()</code> static method. During this step, environment variable key/value pairs are parsed and resolved.</p> <p>Also for same logging style and some additional feature we may also use out-in-the-box module <code>Logger</code> by adding it to providers to use it though whole app</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Logger<span class="token punctuation">,</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">,</span> Logger<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>The most simple way to log port message on app run would be:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> configService <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ConfigService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> logger<span class="token operator">:</span> Logger <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Logger<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">PORT: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>From NestJS IoC container we getting instance of <code>ConfigService</code> and <code>Logger</code> to use them outside application at</p> <p>Once the installation process is complete, you can run the following command at your OS command prompt to start the application listening for inbound HTTP requests:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run start
</code></pre></div><p>This command starts the app with the HTTP server listening on the port defined in the src/main.ts file. Once the application is running, open your browser and navigate to http://localhost:3000/. You should see the Hello World! message.</p> <p>To watch for changes in your files, you can run the following command to start the application:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run start:dev
</code></pre></div><p>We'll get next messages:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run start:dev

<span class="token operator">&gt;</span> project-name@0.0.1 start:dev
<span class="token operator">&gt;</span> nest start --watch

<span class="token punctuation">[</span><span class="token number">17</span>:17:32<span class="token punctuation">]</span> Starting compilation <span class="token keyword">in</span> <span class="token function">watch</span> mode<span class="token punctuation">..</span>.

<span class="token punctuation">[</span><span class="token number">17</span>:17:34<span class="token punctuation">]</span> Found <span class="token number">0</span> errors. Watching <span class="token keyword">for</span> <span class="token function">file</span> changes.

<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>NestFactory<span class="token punctuation">]</span> Starting Nest application<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>InstanceLoader<span class="token punctuation">]</span> ConfigHostModule dependencies initialized +21ms
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>InstanceLoader<span class="token punctuation">]</span> AppModule dependencies initialized +0ms       
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>InstanceLoader<span class="token punctuation">]</span> ConfigModule dependencies initialized +1ms    
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>RoutesResolver<span class="token punctuation">]</span> AppController <span class="token punctuation">{</span>/<span class="token punctuation">}</span>: +25ms
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>RouterExplorer<span class="token punctuation">]</span> Mapped <span class="token punctuation">{</span>/, GET<span class="token punctuation">}</span> route +2ms
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG <span class="token punctuation">[</span>NestApplication<span class="token punctuation">]</span> Nest application successfully started +2ms   
<span class="token punctuation">[</span>Nest<span class="token punctuation">]</span> <span class="token number">28052</span>  - <span class="token number">26.04</span>.2022, <span class="token number">17</span>:17:34     LOG PORT: <span class="token number">3000</span>
</code></pre></div><p>Бачимо, що при запуску <code>npm start:dev</code> виконується відповідний скрипт у <code>package.json</code> та виводить завантеження інстансів модулів, роутер резолвери і т.д. Але зокрема бачимо в кінці логу наш лог порту, у данному випадку 3000, оскільки у змінних середовища знайшло відповідне значення <code>PORT</code>.</p> <p>При роботі з кодом необов'язково самостійно закривати процесс та відкривати, оскільки NestCLI під побою використовує nodemon або щось накшталт його, тому при зміні коду сервер автоматично закривається, білдиться та запускається.</p> <p>Тепер в браузері робимо запит за адресою <a href="http://localhost:3000">http://localhost:3000</a>, та маємо наступну відповідь від сервера:</p> <center><img src="/1.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <p>Сервер пряцює та навіть відповідає на GET запит до рута що являється частиною бойлерплейту.</p> <h2 id="налаштування-проміжного-пз-доступ-до-статичних-фаилів"><a href="#налаштування-проміжного-пз-доступ-до-статичних-фаилів" class="header-anchor">#</a> Налаштування проміжного ПЗ. Доступ до статичних файлів</h2> <p>NestSJ, як і Express та інші фреймворки, по суті, являються собою інструментами серійного виклику функцій проміжної обробки певних отриманих даних та запитів.</p> <p>Функції проміжної обробки (middleware) - це функції, які мають доступ до об'єкту запиту <code>request</code>, об'єкту відповіді <code>response</code> і наступної функції проміжної обробки <code>next</code> в циклі оброблення запиту.
Функції проміжної обробки можуть виконувати такі завдання:</p> <ul><li>Виконання будь-якого коду.</li> <li>Внесення змін до об'єкти запитів і відповідей.</li> <li>Завершення циклу &quot;запит-відповідь&quot;.</li> <li>Виклик наступної функції тимчасової роботи з стека.</li></ul> <p>Якщо поточна функція проміжної обробки завершує цикл &quot;запит-відповідь&quot;, вона повинна викликати <code>next()</code> для передачі управління наступної функції проміжної обробки. В іншому випадку запит зависне.</p> <center style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);padding:1em;"><img src="https://www.plantuml.com/plantuml/svg/TP7B2i8m44NtynMpLB01arrHAVWbiPb5e4rZCiNwzoO-eAtfSWxtde6P9h8EFFOTw9Q7WDVEacFm2ThMUkqOjVUBkRV6TFJGWOuRN6vm1V3nOtN9sXe3tKUA36d8RAQkiUNfW8ucXXbUfTx5KrKjcxcqs_zBPLagLwc2L6vBLLcgIYbn6ymJpoY4A2nHl-ja_3rFz8EB10qvavxq0W00" alt="uml diagram"></center> <p>У NestJS є декілька видів мідлварів, які під своєю назвою попросту полегшують сприятнення
</p> <p>Однією з вбудованих функцій проміжної обробки є функція оброблення запитів до статичного контенту за допомогою інструмента
<a href="https://docs.nestjs.com/recipes/serve-static"><code>@nestjs/serve-static</code></a>
, яка дозволяє налаштувати доступ до статичних файлів.</p> <p>Додамо до <code>app.module.ts</code> наступне:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Logger<span class="token punctuation">,</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule<span class="token punctuation">,</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ServeStaticModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/serve-static'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    ConfigModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ServeStaticModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token operator">:</span> ConfigService</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            rootPath<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'STATIC_PATH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">,</span> Logger<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Маємо шлях <code>'../..'</code>, а не <code>'..'</code> тому що при транспіляції typescript зберігає вже js код у папці <code>dist</code> тому для доступу з директорії <code>dist/src</code> потрібен ще одне повернення.</p></div> <p>Як видно, використовується не просто метод <code>ServeStaticModule.forRoot()</code>, а його асинхронна версія, оскільки нам потрібно с сервісу налаштування вилучити <code>STATIC_PATH</code>, що являє собою значення в змінних середовища <code>./assets</code>.</p> <p>В каталозі <code>./assets</code> створимо файл <code>index.html</code>:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span> EDU JACE server <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span> 
</code></pre></div><p>Створимо глобальный префікс щоб не було колізій зі статичними файлами та було ясно зрозуміло де API серверу:</p> <div class="language-typescript extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setGlobalPrefix</span><span class="token punctuation">(</span><span class="token string">'api'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> configService <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ConfigService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> logger<span class="token operator">:</span> Logger <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Logger<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">PORT: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Перезавантажимо сторінку за адресою <a href="http://localhost:3000">http://localhost:3000</a>. Побачимо відповідь сервера:</p> <center><img src="/2.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <h2 id="оброблення-запитів"><a href="#оброблення-запитів" class="header-anchor">#</a> Оброблення запитів</h2> <p>Маршрутизація визначає, як сервер відповідає на клієнтський запит до конкретної адреси (end point), яким є URI (або шлях), і певного методу запиту HTTP (GET, POST і т.п.).</p> <p>Кожен маршрут може мати одну або кілька функцій обробки, які виконуються при зіставленні маршруту.</p> <p>KOA підтримує всі методи маршрутизації, що відповідають методам стандартним HTTP (get, post, put, head, delete, options, trace, copy, lock, mkcol, move, purge, propfind, proppatch, та багато інших).</p> <p>Шляхи маршрутів можуть бути рядками, шаблонами рядків або регулярними виразами:</p> <ul><li><code>/</code> - рядок, що позначає кореневий маршрут;</li> <li><code>/about</code> - рядок, що позначає маршрут <code>/about</code> (наприклад, <a href="http://localhost:8080/about" target="_blank" rel="noopener noreferrer">http://localhost:8080/about<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>);</li> <li><code>/ab?cd</code> - шаблон рядка, в якому є необов'язкове включення <code>b</code> (<code>acd</code>,<code>abcd</code>);</li> <li><code>/ab+cd</code> - шаблон рядка, в якому є одне або декілька включень <code>b</code> (<code>abcd</code>,<code>abbcd</code>,<code>abbbcd</code>, ...);</li> <li><code>/ab*cd</code> - шаблон рядка, в якому є будь-яка комбінація символів після <code>b</code> (<code>abcd</code>,<code>abxcd</code>,<code>ab123cd</code>, ...);</li> <li><code>/a/</code> - регулярний вираз, який відповідає рядку з літерою <code>a</code>;</li> <li><code>/.*fly$/</code> - регулярний вираз, який відповідає рядку, якій закінчується на <code>fly</code>.</li></ul> <p>In NestJs controllers are responsible for handling incoming requests and returning responses to the client.</p> <p>A controller's purpose is to receive specific requests for the application. The routing mechanism controls which controller receives which requests. Frequently, each controller has more than one route, and different routes can perform different actions.</p> <p>In order to create a basic controller, we use classes and decorators. Decorators associate classes with required metadata and enable Nest to create a routing map (tie requests to the corresponding controllers).</p> <p>Уявімо, що наш сервер буде надавати доступ до даних про президентів Сполучених Штатів.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Простіше за все буде використовувати
<a href="https://docs.nestjs.com/cli/overview#project-structure">Nest CLI</a> що дозволяє уникнути переписування шаблонного коду и почати відразу від дописування згенерованого модуля. Сама команда генерації CRUD модуля виглядала б наступним чином:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>nest g res presidents
</code></pre></div></div> <p>Своримо за шляхом <code>src/</code> папку <code>presidents</code>, де буде весь код модулю.</p> <p>Створимо файл <code>president.entity.ts</code> який буде собою представляти модель данних:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">President</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  photo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Змоделюємо сховище даних. Для цього за шляхом <code>src/presidents/</code> створимо файл <code>presidents.dataset.ts</code>:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> President <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./president.entity'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Barrac Obama'</span><span class="token punctuation">,</span>
    photo<span class="token operator">:</span>
      <span class="token string">'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/President_Barack_Obama.jpg/274px-President_Barack_Obama.jpg'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Donald Trump'</span><span class="token punctuation">,</span>
    photo<span class="token operator">:</span>
      <span class="token string">'https://upload.wikimedia.org/wikipedia/commons/5/56/Donald_Trump_official_portrait.jpg'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Joe Biden'</span><span class="token punctuation">,</span>
    photo<span class="token operator">:</span>
      <span class="token string">'https://upload.wikimedia.org/wikipedia/commons/6/68/Joe_Biden_presidential_portrait.jpg'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> President<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>Далі створимо <code>presidents.repository.ts</code>, який буде виконувати логіку шару доступу між сховищем реальних данних та бізнес логікою:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Presidents <span class="token keyword">from</span> <span class="token string">'./presidents.dataset'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PresidentsRepository</span> <span class="token punctuation">{</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Presidents<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>@Injectable()</code> показує що данний клас може ін'єктуватися у інші модулі, контроллери та провайдери. Наразі даний клас реалізовує лише доступність до всіх президентів.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>У нашому випадку це в маніпуляція данними локального файла, але завдяки архітектури, при необхідності зміни сховища на БД, потребується лише переписати код репозиторія</p></div> <p>Далі створимо <code>presidents.service.ts</code>, що буде виконувати певну бізнес логіку маніпулюючи даними свого одноіменного репозиторія або даними які повертають інші сервіси:</p> <div class="language-typescript extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents.repository'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PresidentsService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> presidentsRepository<span class="token operator">:</span> PresidentsRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>presidentsRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>На виділеній строчці видно приклад як створюється залежність сервісу від репозиторія, або аналогічно цьому односторонній зв'язок інших двух других елементів DI.</p> <p>Далі створимо контроллер <code>presidents.controller.ts</code> який буде використовувати лише свій одноіменний сервіс та являє собою інтерфейсом API:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'presidents'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PresidentsController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> presidentsService<span class="token operator">:</span> PresidentsService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>presidentsService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Для визначення який тип HTTP запиту використовуються декоратори <code>@Get()</code>, <code>@Post()</code>, <code>@Put()</code>, <code>@Patch()</code>, <code>@Delete()</code>.</p> <p>Далі щоб використовувати цей контроллер потрібно створити модуль <code>presidents.module.ts</code>:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents.repository'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>PresidentsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>PresidentsService<span class="token punctuation">,</span> PresidentsRepository<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PresidentsModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Тут визначаються всі контроллери, провайдери(сервіси, репозиторії та інше), залежності модулів.</p> <p>Останнє, для використання модуля президентів додамо до імпорту у загальний модуль:</p> <div class="language-typescript extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Logger<span class="token punctuation">,</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule<span class="token punctuation">,</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ServeStaticModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/serve-static'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PresidentsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./presidents/presidents.module'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    ConfigModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ServeStaticModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> ConfigService<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            rootPath<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../..'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'STATIC_PATH'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PresidentsModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">,</span> Logger<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Таким чином, наш сервер має обробник запитів за шляхом <a href="http://localhost:3000/api/presidents" target="_blank" rel="noopener noreferrer">http://localhost:3000/api/presidents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. В браузері звернемося за цією адресою і отримаємо відповідь:</p> <center><img src="/3.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <h2 id="оброблення-параметрів-запиту"><a href="#оброблення-параметрів-запиту" class="header-anchor">#</a> Оброблення параметрів запиту</h2> <p>Додаткові параметри запиту можна передавати декількома способами:</p> <ul><li>за допомогою частини шляху;</li> <li>за допомогою <code>queryString</code>;</li> <li>за допомогою <code>body</code>;</li> <li>за допомогою  <code>cookie</code>.</li></ul> <p>Якщо в якості шляху використовувати спеціальний шаблон з параметрами <code>/prePath/:param1/:param2/postPath</code>, тоді доступ до параметрів запиту (<code>param1</code>, <code>param2</code>) може здійснюватися за допомогою декоратора <code>@Param()</code> (<code>@Param('param1')</code>, <code>@Param('param2')</code>).</p> <p><code>QueryString</code> є частиною уніфікованого покажчика ресурсу (URL) , який присвоює значення зазначених параметрів. Рядок запиту зазвичай включає поля, додані до базової URL-адреси веб-браузером або іншим клієнтським додатком.
Типова URL-адреса, що містить <code>queryString</code>, така: <a href="https://example.com/over/there?name=ferret" target="_blank" rel="noopener noreferrer">https://example.com/over/there?name=ferret<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. В цьому випадку, шлях - це <code>/over/there</code>, а  <code>queryString</code> - <code>name=ferret</code>. Знак питання використовується як роздільник і не є частиною <code>query</code>. Доступ до параметрів, які передані через <code>queryString</code> здійснюється за допомогою декоратора <code>@Query()</code>.</p> <p>В запитах <code>POST</code>,<code>PUT</code> та інших (окрім <code>GET</code>) можна використати тіло запиту (<code>body</code>) для передачі додаткових атрибутів. Коли ви передаєте атрибути в <code>body</code>, ви передаєте атрибути як частину об'єкта, описаного як <code>json</code>.
NestJS підтримує &quot;з коробки&quot; вилучення тілу з запита за подомогою декоратора <code>@Body()</code>.</p> <p><code>HTTP-cookie</code> - у комп'ютерній термінології поняття, яке використовується для опису інформації у вигляді текстових або бінарних даних, отриманих від веб-сайту на веб-сервері, яка зберігається у клієнта, тобто браузера, а потім відправлена на той самий сайт, якщо його буде повторно відвідано. Таким чином веб-сервер помічає браузер користувача при відвідуванні. Кукі створюються за ініціативою скриптового сценарію на стороні веб-браузера. При наступному візиті сервер буде знати, що користувач вже тут був. За допомогою кукі-технології можна вивчити вподобання відвідувача. Кукі є одним із найточніших засобів визначення унікального користувача. Для зручності оброблення <code>cookies</code> використовують спеціальне middleware <a href="https://www.npmjs.com/package/cookie-parser" target="_blank" rel="noopener noreferrer">cookie-parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, яке аналізує Cookie заголовок та заповнює <code>req.cookies</code> об’єктом, який закріплений за іменами файлів cookie.</p> <p>Для перевірки способів передачі параметрів в запитах, доповнемо файл <code>app.controller.ts</code>:</p> <div class="language-typescript extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Body<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Param<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Query<span class="token punctuation">,</span> Req <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> appService<span class="token operator">:</span> AppService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appService<span class="token punctuation">.</span><span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'echo/:param'</span><span class="token punctuation">)</span>
  <span class="token function">echoGet</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'param'</span><span class="token punctuation">)</span> params<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> query<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> body<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      param<span class="token operator">:</span> params<span class="token punctuation">,</span>
      queryString<span class="token operator">:</span> query<span class="token punctuation">,</span>
      body<span class="token operator">:</span> body<span class="token punctuation">,</span>
      cookie<span class="token operator">:</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'echo/:param'</span><span class="token punctuation">)</span>
  <span class="token function">echoPost</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'param'</span><span class="token punctuation">)</span> params<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> query<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> body<span class="token punctuation">,</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      param<span class="token operator">:</span> params<span class="token punctuation">,</span>
      queryString<span class="token operator">:</span> query<span class="token punctuation">,</span>
      body<span class="token operator">:</span> body<span class="token punctuation">,</span>
      cookie<span class="token operator">:</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>В браузері здійснимо запит за адресою <a href="http://localhost:3000/api/echo/1?name=Barrac&amp;isCurrent=true" target="_blank" rel="noopener noreferrer">http://localhost:3000/api/echo/1?name=Barrac&amp;isCurrent=true<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <center><img src="/5.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <p>Як бачимо, <code>body</code> - це пустий об'єкт, тому що в запитах <code>GET</code> <code>body</code> не підтримується.</p> <p>Для реалізації запиту <code>POST</code> скористаємося <a href="https://www.postman.com/" target="_blank" rel="noopener noreferrer">Postman<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <center><img src="/4.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Останнє оновлення:</span> <span class="time">4/29/2022, 12:41:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/edu-dis-labs/design/" class="prev">
        Проєктування архітектури системи
      </a></span> <span class="next"><a href="/edu-dis-labs/software/restfull-services.html">
        RESTfull сервіси
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/edu-dis-labs/assets/js/app.7ef3414e.js" defer></script><script src="/edu-dis-labs/assets/js/2.3e2da508.js" defer></script><script src="/edu-dis-labs/assets/js/22.75c2533e.js" defer></script>
  </body>
</html>
